

// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Empresa {
  id               Int         @id @default(autoincrement()) @map("id")
  cnpj             String      @db.VarChar(14) @map("cnpj")
  razaoSocial      String      @map("razao_social")
  cidade           String      @map("cidade")
  uf               String      @db.VarChar(2) @map("uf")
  endereco         String      @map("endereco")
  bairro           String      @map("bairro")
  cep              String      @map("cep")
  dataAdesao       DateTime    @db.Date @map("data_adesao")
  horaAdesao       DateTime    @db.Time(0) @map("hora_adesao")
  tenant           String      @map("tenant")
  env              String      @map("env")
  modoContratado   String      @db.VarChar(20) @map("modo_contratado")
  limiteProjetos   Int         @default(0) @map("limite_projetos")
  limiteServidores Int         @default(0) @map("limite_servidores")

  usuarios   Usuario[] @relation("EmpresaUsuarios")
  projetos   Projeto[] @relation("EmpresaProjetos")
  servidores Servidor[] @relation("EmpresaServidores")

  @@unique([tenant, env], name: "tenant_env")
  @@map("empresa")
}

model Projeto {
  id                  Int        @id @default(autoincrement()) @map("id")
  nome                String     @map("nome")
  env                 String     @map("env")
  tenant              String     @map("tenant")
  dataInicio          DateTime   @map("data_inicio")
  usuarioProprietario String     @map("usuario_proprietario")
  status              String     @map("status")
  empresaId           Int?       @map("empresa_id")
  empresa             Empresa?   @relation("EmpresaProjetos", fields: [empresaId], references: [id], onDelete: Cascade)

  servidores Servidor[] @relation("ProjetoServidores")

  @@unique([tenant, env], name: "tenant_env")
  @@map("projeto")
}

model Servidor {
  id                   Int           @id @default(autoincrement()) @map("id")
  nome                 String        @map("nome")
  ip                   String        @map("ip")
  tipo                 String        @map("tipo")
  sistemaOperacional   String        @map("sistema_operacional")
  status               String        @map("status")
  createdAt            DateTime      @default(now()) @map("created_at")
  projetoId            Int           @map("projeto_id")
  projeto              Projeto       @relation("ProjetoServidores", fields: [projetoId], references: [id], onDelete: Cascade)
  empresaId            Int           @map("empresa_id")
  empresa              Empresa       @relation("EmpresaServidores", fields: [empresaId], references: [id], onDelete: Cascade)

  alertasInfra AlertaInfra[] @relation("ServidorAlertasInfra")
  alertasApp   AlertaApp[]   @relation("ServidorAlertasApp")
  contatos     Contato[]     @relation("ServidorContatos")

  @@map("servidor")
}

model Usuario {
  id          Int       @id @default(autoincrement()) @map("id")
  empresaId   Int       @map("empresa")
  nome        String    @map("nome")
  senha       String    @map("senha")
  email       String    @unique @map("email")
  imagem      String?   @map("imagem")
  permissao   Int?      @map("permissao")
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  token       String?   @map("token")
  ativo       Boolean   @default(true) @map("ativo")
  loginAtivo  Boolean?  @map("login_ativo")
  motivo      String?   @map("motivo")
  validade    DateTime? @map("validade")
  perfil      Int?      @map("perfil")
  celular     String?   @map("celular")
  cadastro    Int?      @map("cadastro")

  empresa     Empresa   @relation("EmpresaUsuarios", fields: [empresaId], references: [id])
  grupoUsuarios GrupoUsuario[] @relation("GrupoUsuarios")
  @@map("usuarios")
}
model Grupo {
  id          Int              @id @default(autoincrement()) @map("id")
  nome        String           @map("nome")
  descricao   String?          @map("descricao")
  usuarios    GrupoUsuario[]   @relation("GrupoUsuarios")
  alertas     GrupoAlerta[]    @relation("GrupoAlertas")

  @@map("grupo")
}

model GrupoUsuario {
  id        Int      @id @default(autoincrement()) @map("id")
  usuarioId Int      @map("usuario_id")
  grupoId   Int      @map("grupo_id")
  usuario   Usuario  @relation("GrupoUsuarios", fields: [usuarioId], references: [id], onDelete: Cascade)
  grupo     Grupo    @relation("GrupoUsuarios", fields: [grupoId], references: [id], onDelete: Cascade)

  @@map("grupo_usuario")
}

model GrupoAlerta {
  id             Int           @id @default(autoincrement()) @map("id")
  grupoId        Int           @map("grupo_id")
  grupo          Grupo         @relation("GrupoAlertas", fields: [grupoId], references: [id], onDelete: Cascade)
  alertaInfraId  Int?          @map("alerta_infra_id")
  alertaAppId    Int?          @map("alerta_app_id")
  alertaInfra    AlertaInfra?  @relation("AlertaInfraGrupoAlertas", fields: [alertaInfraId], references: [id], onDelete: Cascade)
  alertaApp      AlertaApp?    @relation("AlertaAppGrupoAlertas", fields: [alertaAppId], references: [id], onDelete: Cascade)

  @@map("grupo_alerta")
}

model AlertaInfra {
  id           Int      @id @default(autoincrement()) @map("id")
  descricao    String   @map("descricao")
  dataHora     DateTime @map("data_hora")
  servidorId   Int
  servidor     Servidor @relation("ServidorAlertasInfra", fields: [servidorId], references: [id], onDelete: Cascade)
  grupoAlertas GrupoAlerta[] @relation("AlertaInfraGrupoAlertas")
  @@map("alerta_infra")
}

model AlertaApp {
  id           Int      @id @default(autoincrement()) @map("id")
  descricao    String   @map("descricao")
  dataHora     DateTime @map("data_hora")
  servidorId   Int
  servidor     Servidor @relation("ServidorAlertasApp", fields: [servidorId], references: [id], onDelete: Cascade)
  grupoAlertas GrupoAlerta[] @relation("AlertaAppGrupoAlertas")
  @@map("alerta_app")
}

model Contato {
  id           Int      @id @default(autoincrement()) @map("id")
  nome         String   @map("nome")
  email        String   @map("email")
  telefone     String   @map("telefone")
  servidorId   Int
  servidor     Servidor @relation("ServidorContatos", fields: [servidorId], references: [id], onDelete: Cascade)

  @@map("contato")
}